const std = @import("std");

const memory_pkg = @import("memory.zig");
const video_pkg = @import("video.zig");
const input_pkg = @import("input.zig");
const bus_pkg = @import("bus.zig");
const cpu_pkg = @import("cpu.zig");

// TODO: Find a better place for this
const FONTSET_SIZE: u8 = 80;
const CHIP8_FONTSET: [FONTSET_SIZE]u8 = .{
    0xF0, 0x90, 0x90, 0x90, 0xF0, // 0
    0x20, 0x60, 0x20, 0x20, 0x70, // 1
    0xF0, 0x10, 0xF0, 0x80, 0xF0, // 2
    0xF0, 0x10, 0xF0, 0x10, 0xF0, // 3
    0x90, 0x90, 0xF0, 0x10, 0x10, // 4
    0xF0, 0x80, 0xF0, 0x10, 0xF0, // 5
    0xF0, 0x80, 0xF0, 0x90, 0xF0, // 6
    0xF0, 0x10, 0x20, 0x40, 0x40, // 7
    0xF0, 0x90, 0xF0, 0x90, 0xF0, // 8
    0xF0, 0x90, 0xF0, 0x10, 0xF0, // 9
    0xF0, 0x90, 0xF0, 0x90, 0x90, // A
    0xE0, 0x90, 0xE0, 0x90, 0xE0, // B
    0xF0, 0x80, 0x80, 0x80, 0xF0, // C
    0xE0, 0x90, 0x90, 0x90, 0xE0, // D
    0xF0, 0x80, 0xF0, 0x80, 0xF0, // E
    0xF0, 0x80, 0xF0, 0x80, 0x80, // F
};

pub fn main() !void {
    var memory = memory_pkg.init();
    var video = video_pkg.init();
    var input = input_pkg.init();
    var bus = bus_pkg.init(&memory, &video, &input);
    var cpu = cpu_pkg.init(&bus);

    // TODO: More do more system initialization here

    while (true) {
        cpu_pkg.tick(&cpu);
    }
}
